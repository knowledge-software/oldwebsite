/*:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::		FMPlug - FileMaker sample plug-in		Copyright ©1997  Claris¨ Corporation.  All Rights Reserved.				:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::*//*:::::::::::::::::::::::::::::   Includes   ::::::::::::::::::::::::::::::*/#include	"FMFlags.h"#if FM_CPU_X86	#if FM_MWERKS		#include <Win32Headers.h>	#else		#include <Windows.h>	#endif#else	#include <Resources.h>	#include <TextUtils.h>	#include <Dialogs.h>	#include <Files.h>	#include <Errors.h>	#include <FileTypesAndCreators.h>//	#include <A4Stuff.h>#endif#include	"FMExtern.h"#include	"KSCalculator.h"/*:::::::::::::::::::::::::::   Forward defs   ::::::::::::::::::::::::::::*/static long Do_Init(short version);static void Do_Shutdown(void);static void Do_Idle(FChar unsafeCalls);static void Do_External(long functionId, FHandle parameter, FHandle result);static void Do_AppPrefs(void);/*:::::::::::::::::::::::::   Main Entry Point   ::::::::::::::::::::::::::*//* This is the entry point into a FileMaker plugin. You should not have to *//* modify anything in this section.										   */#ifdef __cplusplusextern "C"{#endif/* 68K entry point definition */#if TARGET_API_MAC_CARBON	void __declspec(export) FMExternCarbonCallProc(FMExternCallPtr pb);	void __declspec(export) FMExternCarbonCallProc(FMExternCallPtr pb)#elif FM_CPU_68K	pascal void main(FMExternCallPtr pb);	pascal void main(FMExternCallPtr pb)#elif FM_CPU_PPC	void __declspec(export) FMExternCallProc(FMExternCallPtr pb);	void __declspec(export) FMExternCallProc(FMExternCallPtr pb)#else	void __declspec(dllexport) FMExternCallProc(FMExternCallPtr pb);	void __declspec(dllexport) FMExternCallProc(FMExternCallPtr pb)#endif{	/* Setup code */	#if !FM_CPU_X86		short fmOriginalResPath = CurResFile();//		EnterCodeResource();		UseResFile(pb->resourceID);	#endif		gFMExternCallPtr = pb;	/* Message dispatcher */		switch (pb->whichCall) {			case kFMXT_Init:				pb->result = Do_Init(pb->extnVersion);				break;			case kFMXT_Idle:				Do_Idle(pb->unsafeCalls);				break;			case kFMXT_External:				Do_External(pb->parm2, (FHandle)(pb->parm3), (FHandle)(pb->result));				break;			case kFMXT_Shutdown:				Do_Shutdown();				break;			case kFMXT_DoAppPreferences:				Do_AppPrefs();				break;		}	/* Exit code */	#if !FM_CPU_X86		UseResFile(fmOriginalResPath);//		ExitCodeResource();	#endif} /* FMExternCallProc */#ifdef __cplusplus}#endif/*:::::::::::::::::::::::::::   UI Routines   :::::::::::::::::::::::::::::*//* This is a very simple cross platform message displaying routine. The	   *//* only time dialogs should be brought up is in response to an initializa- *//* tion or a set preference message.									   */#define	kErrorMsg		256#define kErrorBody		257#define kPrefMsg		258#define kPrefBody		259static void DisplayMessage(int messageid, int value) {#if FM_CPU_X86	char	caption[64];	char	bodytplate[64];	char	bodytext[64];	LoadString((HINSTANCE)gFMExternCallPtr->instanceID, messageid, caption, sizeof(caption));	LoadString((HINSTANCE)gFMExternCallPtr->instanceID, messageid + 1, bodytplate, sizeof(bodytplate));	wsprintf(bodytext, bodytplate, value);	MessageBox(NULL, bodytext, caption, MB_OK | MB_TASKMODAL);#else	Str255	numstring;	Str255	emptystring;		NumToString(value, numstring);	emptystring[0] = 0;	ParamText(numstring, emptystring, emptystring, emptystring);	CautionAlert(messageid, nil);#endif}/*:::::::::::::::::::::::::   Function Routines   :::::::::::::::::::::::::*//* These are three simple external plugin functions that FileMaker calcs   *//* can call when this plugin is enabled. The input and result parms are	   *//* Mac style handles that contain text. This means that numbers are also   *//* represented as text. The result handle is always empty when these	   *//* routines are called. Only manipulate the input and result parms using   *//* the memory manager callback routines that are defined in FMExtern.h.	   *//* On the Mac they will be real Macintosh handles, but you cannot depend   *//* on which heap they may be located in. On the PC side this handles exist *//* in FileMaker's memory manager pool and has no relation to anything	   *//* called a HANDLE in the Win32 API's.									   *//*-+-+-+-+-+-+-+-+  MY ADDITIONS -+-+-+-+-+-+-+-+-+-+-+-+*/#define kVersionLength	19#define kVersionString	"KS Calculator 1.2.6"/*-+-+-+-+-+-+-+-+  MY ADDITIONS -+-+-+-+-+-+-+-+-+-+-+-+*/static void PluginVersion(FHandle result) {/* Set the result to the version of our plug-in */	FMX_SetHandleSize(result, kVersionLength);	if (FMX_MemoryError() == 0) {#if FM_CPU_X86		lstrcpy((LPTSTR)*result, kVersionString);#else		BlockMoveData(kVersionString, *result, kVersionLength);#endif	} /* if no memory failure */}#pragma	mark	-/*::::::::::::::::::::::::  Init/Shutdown Handler  ::::::::::::::::::::::::*//* These routines are called when the plugin is enabled or disable in	   *//* FileMaker. The user can enable or disable any plugin at any time by	   *//* going to the application prefences panel and changing the state of the  *//* check box in front of the plugin name. The plugin is enabled or		   *//* disable immediately after the click. All plugins that are disabled are  *//* rememeber in the FileMaker preferences file. During launch FileMaker    *//* will enable all plugins it can find except for the onces explicitly     *//* disabled by the user.												   */static long Do_Init(short version) {	int	somethingResult;/* Make sure this is a version of FileMaker I can talk to */	if ((version < kMinExtnVersion) || (version > kMaxExtnVersion)) {		/* Do not display a dialog at this point, let */		/* FileMaker do the error handling instead.   */		return kBadExtnVersion;	}// Examine the gestalt of the system to verify if we have the proper file services.	somethingResult = StartUpServices();	if (somethingResult != kSuccessLoading) {		DisplayMessage(kErrorMsg, somethingResult);		return kDoNotEnable;	}/* Everything is fine */	return kCurrentExtnVersion;}static void Do_Shutdown(void) {	ShutDownServices();}/*:::::::::::::::::::::::::::::  Idle Handler  ::::::::::::::::::::::::::::*//* This is an optional routine. It is only called if the ninth character   *//* in the option string is the character Y. There are two points in File-  *//* Maker where this called. If the "unsafeCalls" parameter is non-zero     *//* then the routine has been called at the same time the low-level network *//* code has been called in FileMaker. Do not do any long processing, UI,   *//* or event munging when unsafeCalls is non-zero. The other time when	   *//* FileMaker will call the idle handler is when FileMaker detects free	   *//* time and does it's own internal idle handling.						   */static void Do_Idle(FChar unsafeCalls) {/* We are going to pretend that the "Something" code needs to make some high level calls */	if (!unsafeCalls) {		IdleServices();	}}/*::::::::::::::::::::::  External Function Handler  ::::::::::::::::::::::*//* This is an optional routine. It is only called if the seventh character *//* in the option string is the character Y. The name of all the external   *//* functions you want to export are listed in a resource. On the Mac they  *//* are the in the 'STR#' id 144 resource and on the PC they start at	   *//* string number 144. The first name will be mapped to functionID 0 and	   *//* incremented by one for each following name. See the section on Funtion  *//* Routines so see how to implement an external function for FileMaker.	   */static void Do_External(long functionId, FHandle parameter, FHandle result) {/* Function dispatcher */	switch (functionId) {/*-+-+-+-+-+-+-+-+  MY ADDITIONS -+-+-+-+-+-+-+-+-+-+-+-+*/	/* First function (PluginVersion) */		case 0:			PluginVersion(result);			break;	/* First function (Calculate) */		case 1:			Calculate(parameter, result);			break;	/* Second function (DMS) */		case 2://			MakeDegreesMinutesSeconds(parameter, result);			break;	/* Third function (DMDM) */		case 3://			MakeDegreesMinutesDecMinutes(parameter, result);			break;/*-+-+-+-+-+-+-+-+  MY ADDITIONS -+-+-+-+-+-+-+-+-+-+-+-+*/	} /* switch */} /* Do_External *//*::::::::::::::::::::::::::  Prference Handler  ::::::::::::::::::::::::::*//* This is an optional routine. It is only called if the sixth character   *//* in the option string is the character Y, also a config button will be   *//* enabled in the Plug-In preference panel. When the button is press this  *//* handler will be called and it is expected that you are going to put up  *//* a dialog box of some sort. An options you want to save should be put in *//* your own preference file on the Mac and your own registery entry or	   *//* ini-file on the PC.													   */static void Do_AppPrefs(void) {}